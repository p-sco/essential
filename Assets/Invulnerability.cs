using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class Invulnerability : Ability
{
    public float cooldown;
    public Sprite sprite;
    public float duration;
    private Transform playerTrans;
    private float currentCooldown;
    private float currentDuration;

    // Start is called before the first frame update
    void Start()
    {
        GameObject playerObject = GameObject.Find("/Player");
        GameObject.Find("/UI").transform.Find("Healthbar_main").transform.Find("Healthbar_fill").GetComponent<Image>().color = Color.blue;
        playerObject.GetComponent<SpriteRenderer>().color = Color.grey;
        playerTrans = playerObject.transform;
        playerObject.GetComponent<PlayerController>().SetInvincible(true);

        PlayerController player = playerObject.GetComponent<PlayerController>();
        duration += player.abilityPower * 0.5f;
        currentCooldown = System.Math.Max(10, cooldown - player.abilityCooldown);
        Invoke("endAbility", duration);
    }

    // Update is called once per frame
    void Update()
    {
        transform.position = playerTrans.position;
    }

    override
    public void cast(Transform playerTransform, Vector2 direction)
    {
        Instantiate(this, playerTransform.position, playerTransform.rotation);
        Transform tmp = GameObject.Find("/UI").transform.Find("AbilityUI").transform.Find("AbilityPanel").transform.Find("CooldownText");
        tmp.SendMessage("SetCooldown", System.Math.Max(10, cooldown - GameObject.Find("/Player").GetComponent<PlayerController>().abilityCooldown));
    }

    override
    public float getCooldown()
    {
        return System.Math.Max(10, cooldown - GameObject.Find("/Player").GetComponent<PlayerController>().abilityCooldown); 
    }

    override
    public Sprite getSprite()
    {
        return sprite;
    }

    override
    public void endAbility()
    {
        GameObject playerObject = GameObject.Find("/Player");
        GameObject.Find("/UI").transform.Find("Healthbar_main").transform.Find("Healthbar_fill").GetComponent<Image>().color = Color.white;
        playerObject.GetComponent<SpriteRenderer>().color = Color.white;
        playerObject.GetComponent<PlayerController>().SetInvincible(false);
        Destroy(gameObject);
    }

    override
    public void updateCooldown(float cdr)
    {
        currentCooldown = System.Math.Max(10, cooldown - cdr);
    }
}
